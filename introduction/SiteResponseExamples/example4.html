

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example 4: Site Response Analysis with Deconvolution Using TransferFunction Tool &mdash; Femora (Fast Efficient Meshing for OpenSees-based Resilience Analysis) 0.5.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=bbbd0671" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=1dd76d02"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../_static/js/copy-button.js?v=47d38097"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Domain Reduction Method (DRM) Examples" href="../DRMExamples/DRM.html" />
    <link rel="prev" title="Example 3: 3D Multi-Processor Site Response Analysis" href="example3.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/Femoralogo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started with Femora</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples and Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../quick_start.html">Quick Start Example (Layered Soil Profile)</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="SiteResponse.html">Site Response Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="example1.html">Example 1: Single-Column Site Response Analysis with Frequency Sweep</a></li>
<li class="toctree-l3"><a class="reference internal" href="example2.html">Example 2: Multi-Material Site Response Analysis with Transfer Function Comparison</a></li>
<li class="toctree-l3"><a class="reference internal" href="example3.html">Example 3: 3D Multi-Processor Site Response Analysis</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Example 4: Site Response Analysis with Deconvolution Using TransferFunction Tool</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-description">Model Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#deconvolution-process">Deconvolution Process</a></li>
<li class="toctree-l4"><a class="reference internal" href="#numerical-verification">Numerical Verification</a></li>
<li class="toctree-l4"><a class="reference internal" href="#results-and-analysis">Results and Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#applications-and-benefits">Applications and Benefits</a></li>
<li class="toctree-l4"><a class="reference internal" href="#conclusion">Conclusion</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code-access">Code Access</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../DRMExamples/DRM.html">Domain Reduction Method (DRM) Examples</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../technical/index.html">Technical Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Femora (Fast Efficient Meshing for OpenSees-based Resilience Analysis)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples and Tutorials</a></li>
          <li class="breadcrumb-item"><a href="SiteResponse.html">Site Response Examples</a></li>
      <li class="breadcrumb-item active">Example 4: Site Response Analysis with Deconvolution Using TransferFunction Tool</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/introduction/SiteResponseExamples/example4.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-4-site-response-analysis-with-deconvolution-using-transferfunction-tool">
<h1>Example 4: Site Response Analysis with Deconvolution Using TransferFunction Tool<a class="headerlink" href="#example-4-site-response-analysis-with-deconvolution-using-transferfunction-tool" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This example demonstrates the deconvolution capability of the <code class="docutils literal notranslate"><span class="pre">TransferFunction</span></code> class in Femora. Building upon Example 2’s multi-layered soil profile, this example shows how to:</p>
<ol class="arabic simple">
<li><p>Start with a recorded surface motion (Ricker wavelet)</p></li>
<li><p>Use the <code class="docutils literal notranslate"><span class="pre">TransferFunction</span></code> tool to deconvolve and compute the corresponding bedrock motion</p></li>
<li><p>Apply the computed bedrock motion as input to a numerical site response analysis</p></li>
<li><p>Verify that the numerical model reproduces the original surface motion</p></li>
</ol>
<p>This workflow is particularly valuable for creating Domain Reduction Method (DRM) datasets and validating site response models against recorded surface motions.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/Schematic.png"><img alt="Deconvolution Workflow Schematic" src="../../_images/Schematic.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Schematic representation of the deconvolution workflow: from surface motion to bedrock motion and back to surface</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="model-description">
<h2>Model Description<a class="headerlink" href="#model-description" title="Link to this heading"></a></h2>
<p><strong>Soil Profile:</strong></p>
<p>This example uses the same three-layer soil profile as Example 2:</p>
<ul class="simple">
<li><p><strong>Layer 1 (Bottom):</strong> 10m thick - Stiff material (Vs = 262.5 m/s)</p></li>
<li><p><strong>Layer 2 (Middle):</strong> 6m thick - Medium stiffness material (Vs = 196.3 m/s)</p></li>
<li><p><strong>Layer 3 (Top):</strong> 2m thick - Soft material (Vs = 144.3 m/s)</p></li>
</ul>
<p>All material properties, including Rayleigh damping parameters, are identical to Example 2.</p>
<p><strong>Input Motion:</strong></p>
<p>Unlike previous examples that used frequency sweep inputs, this example uses a Ricker wavelet recorded at the surface. The Ricker wavelet provides a realistic broadband signal that is commonly used in seismic analysis.</p>
</section>
<section id="deconvolution-process">
<h2>Deconvolution Process<a class="headerlink" href="#deconvolution-process" title="Link to this heading"></a></h2>
<p>The key innovation in this example is the use of Femora’s <code class="docutils literal notranslate"><span class="pre">TransferFunction</span></code> class to perform deconvolution. The process is implemented in the <code class="docutils literal notranslate"><span class="pre">deconvolve.py</span></code> script:</p>
<section id="loading-surface-motion">
<h3>Loading Surface Motion<a class="headerlink" href="#loading-surface-motion" title="Link to this heading"></a></h3>
<p>First, we load the recorded surface motion using the <code class="docutils literal notranslate"><span class="pre">TimeHistory</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">femora.tools.transferFunction</span><span class="w"> </span><span class="kn">import</span> <span class="n">TransferFunction</span><span class="p">,</span> <span class="n">TimeHistory</span>

<span class="c1"># Load the surface motion (Ricker wavelet)</span>
<span class="n">record</span> <span class="o">=</span> <span class="n">TimeHistory</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">acc_file</span><span class="o">=</span><span class="s2">&quot;ricker_surface.acc&quot;</span><span class="p">,</span>
                          <span class="n">time_file</span><span class="o">=</span><span class="s2">&quot;ricker_surface.time&quot;</span><span class="p">,</span>
                          <span class="n">unit_in_g</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">gravity</span><span class="o">=</span><span class="mf">9.81</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="defining-soil-profile">
<h3>Defining Soil Profile<a class="headerlink" href="#defining-soil-profile" title="Link to this heading"></a></h3>
<p>The soil profile is defined with the same properties as Example 2:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">soil</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>  <span class="s2">&quot;vs&quot;</span><span class="p">:</span> <span class="mf">144.2535646321813</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">:</span> <span class="mf">19.8</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="mf">9.81</span><span class="p">,</span> <span class="s2">&quot;damping&quot;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span>
     <span class="s2">&quot;damping_type&quot;</span><span class="p">:</span><span class="s2">&quot;rayleigh&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="mf">2.76</span><span class="p">,</span> <span class="s2">&quot;f2&quot;</span><span class="p">:</span> <span class="mf">13.84</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>  <span class="s2">&quot;vs&quot;</span><span class="p">:</span> <span class="mf">196.2675276462639</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">:</span> <span class="mf">19.1</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="mf">9.81</span><span class="p">,</span> <span class="s2">&quot;damping&quot;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span>
     <span class="s2">&quot;damping_type&quot;</span><span class="p">:</span><span class="s2">&quot;rayleigh&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="mf">2.76</span><span class="p">,</span> <span class="s2">&quot;f2&quot;</span><span class="p">:</span> <span class="mf">13.84</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;vs&quot;</span><span class="p">:</span> <span class="mf">262.5199305117452</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">:</span> <span class="mf">19.9</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="mf">9.81</span><span class="p">,</span> <span class="s2">&quot;damping&quot;</span><span class="p">:</span> <span class="mf">0.03</span><span class="p">,</span>
     <span class="s2">&quot;damping_type&quot;</span><span class="p">:</span><span class="s2">&quot;rayleigh&quot;</span><span class="p">,</span> <span class="s2">&quot;f1&quot;</span><span class="p">:</span> <span class="mf">2.76</span><span class="p">,</span> <span class="s2">&quot;f2&quot;</span><span class="p">:</span> <span class="mf">13.84</span><span class="p">},</span>
<span class="p">]</span>
<span class="n">rock</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vs&quot;</span><span class="p">:</span> <span class="mi">8000</span><span class="p">,</span> <span class="s2">&quot;rho&quot;</span><span class="p">:</span> <span class="mf">2000.0</span><span class="p">,</span> <span class="s2">&quot;damping&quot;</span><span class="p">:</span> <span class="mf">0.00</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="performing-deconvolution">
<h3>Performing Deconvolution<a class="headerlink" href="#performing-deconvolution" title="Link to this heading"></a></h3>
<p>The deconvolution is performed using the <code class="docutils literal notranslate"><span class="pre">_deconvolve</span></code> method of the <code class="docutils literal notranslate"><span class="pre">TransferFunction</span></code> class:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create transfer function instance</span>
<span class="n">tf</span> <span class="o">=</span> <span class="n">TransferFunction</span><span class="p">(</span><span class="n">soil</span><span class="p">,</span> <span class="n">rock</span><span class="p">,</span> <span class="n">f_max</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>

<span class="c1"># Deconvolve to get bedrock motion</span>
<span class="n">bedrock</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">_deconvolve</span><span class="p">(</span><span class="n">time_history</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>

<span class="c1"># Save the computed bedrock motion</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s2">&quot;ricker_base.acc&quot;</span><span class="p">,</span> <span class="n">bedrock</span><span class="o">.</span><span class="n">acceleration</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6f</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s2">&quot;ricker_base.time&quot;</span><span class="p">,</span> <span class="n">bedrock</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.6f</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Generate comparison plots</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">plot_deconvolved_motion</span><span class="p">(</span><span class="n">time_history</span><span class="o">=</span><span class="n">record</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">_deconvolve</span></code> method works by:</p>
<ol class="arabic simple">
<li><p>Converting the surface time history to frequency domain</p></li>
<li><p>Applying the inverse of the transfer function to remove site amplification effects</p></li>
<li><p>Converting back to time domain to obtain the bedrock motion</p></li>
</ol>
</section>
</section>
<section id="numerical-verification">
<h2>Numerical Verification<a class="headerlink" href="#numerical-verification" title="Link to this heading"></a></h2>
<p>The computed bedrock motion is then used as input to the same numerical model as Example 2. The numerical model applies uniform excitation at the base of the soil column using the deconvolved bedrock motion.</p>
<p><strong>Model Setup:</strong></p>
<p>The numerical model setup is identical to Example 2, with the key difference being the input motion source. Instead of using a frequency sweep, the model uses the computed bedrock acceleration as the base excitation.</p>
<p><strong>Expected Results:</strong></p>
<p>If the deconvolution and numerical modeling are accurate, the surface motion computed by the numerical model should closely match the original recorded surface motion that was used for deconvolution.</p>
</section>
<section id="results-and-analysis">
<h2>Results and Analysis<a class="headerlink" href="#results-and-analysis" title="Link to this heading"></a></h2>
<section id="transfer-function-comparison">
<h3>Transfer Function Comparison<a class="headerlink" href="#transfer-function-comparison" title="Link to this heading"></a></h3>
<p>The transfer function comparison demonstrates the accuracy of the deconvolution process:</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/TFCompare3.png"><img alt="Transfer Function Comparison" src="../../_images/TFCompare3.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Comparison of analytical transfer function with numerical results from the deconvolved motion</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="time-history-comparison">
<h3>Time History Comparison<a class="headerlink" href="#time-history-comparison" title="Link to this heading"></a></h3>
<p>The most important validation is the comparison between time histories:</p>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/TimeHistories.png"><img alt="Time History Comparison" src="../../_images/TimeHistories.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Comparison of time histories: original surface motion (used for deconvolution), computed bedrock motion, and numerical surface response</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>This figure shows three key time histories:</p>
<ol class="arabic simple">
<li><p><strong>Numerical Surface Response (blue):</strong> The surface motion computed by applying the bedrock motion to the numerical model</p></li>
<li><p><strong>Computed Bedrock Motion (red):</strong> The result of deconvolving the surface motion</p></li>
<li><p><strong>Original Surface Motion (green):</strong> The Ricker wavelet recorded at the surface</p></li>
</ol>
<p>The excellent agreement between the original surface motion and the numerical surface response validates both the deconvolution process and the numerical model accuracy.</p>
</section>
<section id="simulation-visualization">
<h3>Simulation Visualization<a class="headerlink" href="#simulation-visualization" title="Link to this heading"></a></h3>
<video width="600" controls>
  <source src="../images/SiteResponse/Example4/movie.mp4" type="video/mp4">
  Your browser does not support the video tag.
</video><p>This animation demonstrates the wave propagation from bedrock to surface using the deconvolved input motion, showing how the original surface motion is reproduced through the soil layers.</p>
</section>
</section>
<section id="applications-and-benefits">
<h2>Applications and Benefits<a class="headerlink" href="#applications-and-benefits" title="Link to this heading"></a></h2>
<p><strong>Model Validation:</strong></p>
<p>The deconvolution process provides a powerful tool for validating site response models. By comparing the forward-modeled surface response with the original recorded motion, you can assess the accuracy of your soil profile characterization and modeling assumptions.</p>
<p><strong>Practical Workflow:</strong></p>
<ol class="arabic simple">
<li><p>Obtain recorded surface motions from seismic stations</p></li>
<li><p>Characterize the local soil profile (layering, properties)</p></li>
<li><p>Use deconvolution to compute equivalent bedrock motion</p></li>
<li><p>Apply bedrock motion to detailed numerical models</p></li>
<li><p>Validate results against recorded surface motion</p></li>
</ol>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading"></a></h2>
<p>This example demonstrates:</p>
<ol class="arabic simple">
<li><p>The practical application of the <code class="docutils literal notranslate"><span class="pre">TransferFunction</span></code> class for deconvolution</p></li>
<li><p>How to create realistic bedrock motions from surface recordings</p></li>
<li><p>The validation of numerical models through time history comparison</p></li>
<li><p>A complete workflow for site-specific seismic analysis</p></li>
</ol>
<p>The deconvolution capability in Femora provides a bridge between recorded seismic data and numerical modeling, enabling more realistic and validated site response analyses.</p>
</section>
<section id="code-access">
<h2>Code Access<a class="headerlink" href="#code-access" title="Link to this heading"></a></h2>
<p>The full source code for this example is available in the Femora repository:</p>
<ul class="simple">
<li><p>Example directory: <code class="docutils literal notranslate"><span class="pre">examples/SiteResponse/Example4/</span></code></p></li>
<li><p>Deconvolution script: <code class="docutils literal notranslate"><span class="pre">examples/SiteResponse/Example4/deconvolve.py</span></code></p></li>
<li><p>Numerical model script: <code class="docutils literal notranslate"><span class="pre">examples/SiteResponse/Example4/femoramodel.py</span></code></p></li>
<li><p>Post-processing script: <code class="docutils literal notranslate"><span class="pre">examples/SiteResponse/Example4/plot.py</span></code></p></li>
</ul>
<p>The deconvolution script is the key component of this example:</p>
<div class="literal-block-wrapper docutils container" id="site-response-example4-deconvolve-code">
<div class="code-block-caption"><span class="caption-text">Example 4 - The code for building the femora model.</span><a class="headerlink" href="#site-response-example4-deconvolve-code" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">femora</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fm</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>



<span class="c1"># create one damping for all the meshParts</span>
<span class="n">uniformDamp</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">damping</span><span class="o">.</span><span class="n">frequencyRayleigh</span><span class="p">(</span><span class="n">f1</span> <span class="o">=</span> <span class="mf">2.76</span><span class="p">,</span> <span class="n">f2</span> <span class="o">=</span> <span class="mf">13.84</span><span class="p">,</span> <span class="n">dampingFactor</span><span class="o">=</span><span class="mf">0.03</span><span class="p">)</span>
<span class="n">region</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">elementRegion</span><span class="p">(</span><span class="n">damping</span><span class="o">=</span><span class="n">uniformDamp</span><span class="p">)</span>

<span class="c1"># defining the mesh parts</span>
<span class="n">Xmin</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">;</span><span class="n">Xmax</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Ymin</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">;</span><span class="n">Ymax</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Zmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">18.</span><span class="p">;</span><span class="n">Zmax</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">dx</span>   <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span> <span class="n">dy</span>   <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">Nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">Xmax</span> <span class="o">-</span> <span class="n">Xmin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span>
<span class="n">Ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">Ymax</span> <span class="o">-</span> <span class="n">Ymin</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span>


<span class="n">layers_properties</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Dense Ottawa1&quot;</span><span class="p">,</span>  <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="mf">145.0e6</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">19.9</span><span class="p">,</span>  <span class="s2">&quot;nu&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;thickness&quot;</span><span class="p">:</span> <span class="mf">2.6</span><span class="p">,</span> <span class="s2">&quot;dz&quot;</span><span class="p">:</span> <span class="mf">1.3</span><span class="p">},</span> 
    <span class="p">{</span><span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Dense Ottawa2&quot;</span><span class="p">,</span>  <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="mf">145.0e6</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">19.9</span><span class="p">,</span>  <span class="s2">&quot;nu&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;thickness&quot;</span><span class="p">:</span> <span class="mf">2.4</span><span class="p">,</span> <span class="s2">&quot;dz&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Dense Ottawa3&quot;</span><span class="p">,</span>  <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="mf">145.0e6</span><span class="p">,</span> <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">19.9</span><span class="p">,</span>  <span class="s2">&quot;nu&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;thickness&quot;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="s2">&quot;dz&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Loose Ottawa&quot;</span><span class="p">,</span>   <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="mf">75.0e6</span><span class="p">,</span>  <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">19.1</span><span class="p">,</span>  <span class="s2">&quot;nu&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;thickness&quot;</span><span class="p">:</span> <span class="mf">6.0</span><span class="p">,</span> <span class="s2">&quot;dz&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span> 
    <span class="p">{</span><span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Dense Montrey&quot;</span><span class="p">,</span>  <span class="s2">&quot;G&quot;</span><span class="p">:</span> <span class="mf">42.0e6</span><span class="p">,</span>  <span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="mf">19.8</span><span class="p">,</span>  <span class="s2">&quot;nu&quot;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span> <span class="s2">&quot;thickness&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="s2">&quot;dz&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">}</span> 
<span class="p">]</span>


<span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers_properties</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;user_name&quot;</span><span class="p">]</span>
    <span class="n">nu</span>   <span class="o">=</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">]</span>
    <span class="n">rho</span>  <span class="o">=</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;gamma&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="mf">9.81</span>        <span class="c1"># Density in kg/m^3</span>
    <span class="n">Vs</span>   <span class="o">=</span> <span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;G&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">rho</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>           <span class="c1"># Shear wave velocity in m/s</span>
    <span class="n">E</span>    <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;G&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;nu&quot;</span><span class="p">])</span>  <span class="c1"># Young&#39;s modulus in Pa</span>
    <span class="n">E</span>    <span class="o">=</span> <span class="n">E</span> <span class="o">/</span> <span class="mf">1000.</span>                           <span class="c1"># Convert to kPa</span>
    <span class="n">rho</span>  <span class="o">=</span> <span class="n">rho</span> <span class="o">/</span> <span class="mf">1000.</span>                         <span class="c1"># Convert to kg/m^3</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Layer: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">, Vs: </span><span class="si">{</span><span class="n">Vs</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>


    <span class="c1"># Define the material</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">create_material</span><span class="p">(</span><span class="n">material_category</span><span class="o">=</span><span class="s2">&quot;nDMaterial&quot;</span><span class="p">,</span> <span class="n">material_type</span><span class="o">=</span><span class="s2">&quot;ElasticIsotropic&quot;</span><span class="p">,</span> <span class="n">user_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="n">nu</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">)</span>

    <span class="c1"># Define the element</span>
    <span class="n">ele</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_type</span><span class="o">=</span><span class="s2">&quot;stdBrick&quot;</span><span class="p">,</span> <span class="n">ndof</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">b3</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s2">&quot;Volume mesh&quot;</span><span class="p">,</span> <span class="n">mesh_part_type</span><span class="o">=</span><span class="s2">&quot;Uniform Rectangular Grid&quot;</span><span class="p">,</span> 
                                 <span class="n">user_name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
                                <span class="o">**</span><span class="p">{</span>
                                    <span class="s1">&#39;X Min&#39;</span><span class="p">:</span> <span class="n">Xmin</span><span class="p">,</span> <span class="s1">&#39;X Max&#39;</span><span class="p">:</span> <span class="n">Xmax</span><span class="p">,</span>
                                    <span class="s1">&#39;Y Min&#39;</span><span class="p">:</span> <span class="n">Ymin</span><span class="p">,</span> <span class="s1">&#39;Y Max&#39;</span><span class="p">:</span> <span class="n">Ymax</span><span class="p">,</span>
                                    <span class="s1">&#39;Z Min&#39;</span><span class="p">:</span> <span class="n">Zmin</span><span class="p">,</span> <span class="s1">&#39;Z Max&#39;</span><span class="p">:</span> <span class="n">Zmin</span> <span class="o">+</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;thickness&quot;</span><span class="p">],</span>
                                    <span class="s1">&#39;Nx Cells&#39;</span><span class="p">:</span> <span class="n">Nx</span><span class="p">,</span> <span class="s1">&#39;Ny Cells&#39;</span><span class="p">:</span> <span class="n">Ny</span><span class="p">,</span> <span class="s1">&#39;Nz Cells&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;thickness&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;dz&quot;</span><span class="p">])</span>
                                <span class="p">})</span>
    <span class="n">Zmin</span> <span class="o">+=</span> <span class="n">layer</span><span class="p">[</span><span class="s2">&quot;thickness&quot;</span><span class="p">]</span>


<span class="c1"># #  Create assembly Sections</span>
<span class="n">fm</span><span class="o">.</span><span class="n">assembler</span><span class="o">.</span><span class="n">create_section</span><span class="p">(</span><span class="n">meshparts</span><span class="o">=</span><span class="p">[</span><span class="n">layer</span><span class="p">[</span><span class="s2">&quot;user_name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers_properties</span><span class="p">],</span> <span class="n">num_partitions</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># Assemble the mesh parts</span>
<span class="n">fm</span><span class="o">.</span><span class="n">assembler</span><span class="o">.</span><span class="n">Assemble</span><span class="p">()</span>

<span class="c1"># Create a TimeSeries for the uniform excitation</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">timeSeries</span><span class="o">.</span><span class="n">create_time_series</span><span class="p">(</span><span class="n">series_type</span><span class="o">=</span><span class="s2">&quot;path&quot;</span><span class="p">,</span>
                                              <span class="n">filePath</span><span class="o">=</span><span class="s2">&quot;ricker_base.acc&quot;</span><span class="p">,</span>
                                              <span class="n">fileTime</span><span class="o">=</span><span class="s2">&quot;ricker_base.time&quot;</span><span class="p">,</span>
                                              <span class="n">factor</span><span class="o">=</span> <span class="mf">9.81</span><span class="p">)</span>

<span class="c1"># Create a pattern for the uniform excitation</span>
<span class="n">kobe</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">create_pattern</span><span class="p">(</span><span class="n">pattern_type</span><span class="o">=</span><span class="s2">&quot;uniformexcitation&quot;</span><span class="p">,</span><span class="n">dof</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">time_series</span><span class="o">=</span><span class="n">timeseries</span><span class="p">)</span>


<span class="c1"># boundary conditions</span>
<span class="n">fm</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">mp</span><span class="o">.</span><span class="n">create_laminar_boundary</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">17.9</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">dofs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">direction</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">constraint</span><span class="o">.</span><span class="n">sp</span><span class="o">.</span><span class="n">fixMacroZmin</span><span class="p">(</span><span class="n">dofs</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">tol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>


<span class="c1"># Create a recorder for the whole model</span>
<span class="n">mkdir</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">tcl</span><span class="p">(</span><span class="s2">&quot;file mkdir Results&quot;</span><span class="p">)</span>
<span class="n">recorder</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">recorder</span><span class="o">.</span><span class="n">create_recorder</span><span class="p">(</span><span class="s2">&quot;vtkhdf&quot;</span><span class="p">,</span> <span class="n">file_base_name</span><span class="o">=</span><span class="s2">&quot;Results/result.vtkhdf&quot;</span><span class="p">,</span><span class="n">resp_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;accel&quot;</span><span class="p">,</span> <span class="s2">&quot;disp&quot;</span><span class="p">,</span> <span class="s2">&quot;vel&quot;</span><span class="p">],</span> <span class="n">delta_t</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>

<span class="c1"># gravity analysis</span>
<span class="n">newmark_gamma</span> <span class="o">=</span> <span class="mf">0.6</span>
<span class="n">newnark_beta</span> <span class="o">=</span> <span class="p">(</span><span class="n">newmark_gamma</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span>
<span class="n">system</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">bandGeneral</span><span class="p">()</span>
<span class="n">numberer</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">numberer</span><span class="o">.</span><span class="n">rcm</span><span class="p">()</span>
<span class="n">dampNewmark</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">integrator</span><span class="o">.</span><span class="n">newmark</span><span class="p">(</span><span class="n">gamma</span><span class="o">=</span><span class="n">newmark_gamma</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">newnark_beta</span><span class="p">)</span>
<span class="n">gravity</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">create_default_transient_analysis</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;gravity&quot;</span><span class="p">,</span> 
                                                        <span class="n">dt</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">num_steps</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                                                        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="n">system</span><span class="p">,</span>
                                                                 <span class="s2">&quot;numberer&quot;</span><span class="p">:</span> <span class="n">numberer</span><span class="p">,</span>
                                                                 <span class="s2">&quot;integrator&quot;</span><span class="p">:</span> <span class="n">dampNewmark</span><span class="p">})</span>

<span class="c1"># dynamic analysis</span>
<span class="n">dynamic</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">create_default_transient_analysis</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;dynamic&quot;</span><span class="p">,</span> 
                                                        <span class="n">final_time</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
                                                        <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;system&quot;</span><span class="p">:</span> <span class="n">system</span><span class="p">,</span>
                                                                 <span class="s2">&quot;numberer&quot;</span><span class="p">:</span> <span class="n">numberer</span><span class="p">})</span>


<span class="n">reset</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">seTime</span><span class="p">(</span><span class="n">pseudo_time</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

<span class="c1"># Add the recorder and gravity analysis step to the process</span>
<span class="n">fm</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">gravity</span><span class="p">,</span>  <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Gravity Analysis Step&quot;</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">kobe</span><span class="p">,</span>     <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Uniform Excitation (Kobe record)&quot;</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">mkdir</span><span class="p">,</span>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Create Results Directory&quot;</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">recorder</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Recorder of the whole model&quot;</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">reset</span><span class="p">,</span>    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Reset pseudo time&quot;</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">dynamic</span><span class="p">,</span>  <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Dynamic Analysis Step&quot;</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">export_to_tcl</span><span class="p">(</span><span class="s2">&quot;mesh.tcl&quot;</span><span class="p">)</span>


<span class="c1"># fm.gui()</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example3.html" class="btn btn-neutral float-left" title="Example 3: 3D Multi-Processor Site Response Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../DRMExamples/DRM.html" class="btn btn-neutral float-right" title="Domain Reduction Method (DRM) Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Amin Pakzad.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>