

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Example 3: Seismic Wave Basin Effects Model with External Mesh &mdash; Femora (Fast Efficient Meshing for OpenSees-based Resilience Analysis) 0.5.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=bbbd0671" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=1dd76d02"></script>
      <script src="../../_static/doctools.js?v=9a2dae69"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../../_static/js/copy-button.js?v=47d38097"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Technical Documentation" href="../../technical/index.html" />
    <link rel="prev" title="Example 2: Multi-layer Soil Model with Absorbing Boundaries" href="example2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/Femoralogo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started with Femora</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples.html">Examples and Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../quick_start.html">Quick Start Example (Layered Soil Profile)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SiteResponseExamples/SiteResponse.html">Site Response Examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="DRM.html">Domain Reduction Method (DRM) Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="example1.html">Example 1: Domain Reduction Method (DRM) Site Response Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="example2.html">Example 2: Multi-layer Soil Model with Absorbing Boundaries</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Example 3: Seismic Wave Basin Effects Model with External Mesh</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#schematic-model-representation">Schematic Model Representation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#model-description">Model Description</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-by-step-model-development">Step-by-Step Model Development</a></li>
<li class="toctree-l4"><a class="reference internal" href="#results-and-analysis">Results and Analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#data-visualization-and-post-processing">Data Visualization and Post-Processing</a></li>
<li class="toctree-l4"><a class="reference internal" href="#code-access">Code Access</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="DRM.html#references">References</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Technical Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../technical/index.html">Technical Documentation</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developer/index.html">Developer Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Femora (Fast Efficient Meshing for OpenSees-based Resilience Analysis)</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples and Tutorials</a></li>
          <li class="breadcrumb-item"><a href="DRM.html">Domain Reduction Method (DRM) Examples</a></li>
      <li class="breadcrumb-item active">Example 3: Seismic Wave Basin Effects Model with External Mesh</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/introduction/DRMExamples/example3.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="example-3-seismic-wave-basin-effects-model-with-external-mesh">
<h1>Example 3: Seismic Wave Basin Effects Model with External Mesh<a class="headerlink" href="#example-3-seismic-wave-basin-effects-model-with-external-mesh" title="Link to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>This example extends Example 2 by incorporating a semi-hemispherical basin with soft soil materials to demonstrate how basins affect seismic wave propagation. The model uses external mesh parts to precisely define the basin geometry and applies different soft material properties to study their impact on ground motion amplification.</p>
<p>Basin effects represent one of the most significant site amplification phenomena in earthquake engineering. Sedimentary basins can trap seismic waves, causing resonance, extended duration of shaking, and amplification of ground motion. These effects have been observed in many major earthquakes, such as the 1985 Mexico City earthquake, the 1994 Northridge earthquake, and the 1995 Kobe earthquake, where localized damage was strongly correlated with basin geometry and soft soil deposits.</p>
<p>The model enhancements in this example include:</p>
<ul class="simple">
<li><p>A semi-hemispherical basin embedded in the soil profile, representing a simplified version of real-world geological basin structures</p></li>
<li><p>Use of external mesh for complex geometry modeling, demonstrating Femora’s capability to handle non-rectangular geometries</p></li>
<li><p>Soft soil materials in the basin with varying shear wave velocities (Vs=150 m/s and Vs=200 m/s) to study velocity contrast effects</p></li>
<li><p>Comparative analysis of seismic response with different basin properties to quantify amplification factors</p></li>
</ul>
<p>This example demonstrates Femora’s capability to model complex subsurface geometries and analyze their effects on seismic wave propagation, which is essential for site-specific seismic hazard assessment in regions with complex geological conditions.</p>
</section>
<section id="schematic-model-representation">
<h2>Schematic Model Representation<a class="headerlink" href="#schematic-model-representation" title="Link to this heading"></a></h2>
<p>Before implementing the detailed basin model, let’s first understand the conceptual geometry. The basin is created by intersecting a half-sphere with a rectangular ground layer box:</p>
<div style="width: 100%; max-width: 800px; height: 500px; margin: 0 auto; border: 1px solid #ddd;">
    <iframe src="../images/DRM/Example3/schematic_model.html" style="width: 100%; height: 100%; border: none;"></iframe>
</div><p>This schematic visualization illustrates the geometric construction of the semi-hemispherical basin:</p>
<ul class="simple">
<li><p><strong>Blue Box</strong>: Represents the ground layer box (the soil domain)</p></li>
<li><p><strong>Red Half-Sphere</strong>: Represents the geometric shape used to create the basin</p></li>
<li><p><strong>Green Region</strong>: Shows the intersection of the box and half-sphere, forming the semi-hemispherical basin that will be used in the model</p></li>
</ul>
<p>This boolean operation approach (intersection of a sphere and box) provides a precise way to define the semi-hemispherical basin geometry. In the actual implementation, we’ll use a similar approach but with finite element meshes rather than continuous geometric objects.</p>
</section>
<section id="model-description">
<h2>Model Description<a class="headerlink" href="#model-description" title="Link to this heading"></a></h2>
<p><strong>Basin Geometry:</strong></p>
<ul class="simple">
<li><p>Semi-hemispherical basin shape - chosen for its geometric simplicity while still capturing the essential physics of wave focusing and multi-dimensional resonance</p></li>
<li><p>Center coordinates: (0, 0, 70) meters - positioned at the top surface of the model to maximize surface wave interaction</p></li>
<li><p>Radius: 85 meters - selected to create significant basin effects while maintaining computational efficiency</p></li>
<li><p>Only intersects with Layer 1 and Layer 2 of the soil profile - allowing study of soft soil deposits in the near-surface region most important for engineering applications</p></li>
<li><p>External mesh implementation for precise geometric representation - enabling accurate modeling of the curved basin interface that cannot be achieved with rectilinear elements</p></li>
</ul>
<p><strong>Basin Material Properties:</strong></p>
<ul class="simple">
<li><dl class="simple">
<dt>Two soft material variants tested to evaluate velocity contrast sensitivity:</dt><dd><ul>
<li><p>Vs = 150 m/s (primary model) - representing soft sediments</p></li>
<li><p>Vs = 200 m/s (comparison model) - representing slightly stiffer but still soft sedimentary materials</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Vp/Vs ratio maintained at 2.0</p></li>
<li><p>Reduced density: 1.8 ton/m³ (compared to ~2.14 ton/m³ for surrounding soil) - representative of younger, less compacted deposits</p></li>
<li><p>Damping ratio (xi_s): 0.03 (higher than surrounding soil) - accounting for the higher hysteretic energy dissipation characteristic of softer materials</p></li>
</ul>
</section>
<section id="step-by-step-model-development">
<h2>Step-by-Step Model Development<a class="headerlink" href="#step-by-step-model-development" title="Link to this heading"></a></h2>
<p>This section outlines the key steps in developing this model, focusing on the differences and enhancements from Example 2.</p>
<section id="initial-setup-and-basin-configuration">
<h3>1. Initial Setup and Basin Configuration<a class="headerlink" href="#initial-setup-and-basin-configuration" title="Link to this heading"></a></h3>
<p>First, the semi-hemispherical basin is defined with its geometric parameters:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters for the semihemispherical hole</span>
<span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">70</span>  <span class="c1"># Center at the top surface</span>
<span class="n">radius</span> <span class="o">=</span> <span class="mf">85.0</span>  <span class="c1"># Radius of the semihemisphere</span>
</pre></div>
</div>
<p>These parameters establish that the basin:</p>
<blockquote>
<div><ul class="simple">
<li><p>Is centered at the origin in the horizontal plane (x,y = 0,0)</p></li>
<li><p>Has its top at z=70 m (at the ground surface)</p></li>
<li><p>Extends downward with a radius of 85 m</p></li>
</ul>
</div></blockquote>
<p>The center and radius parameters were carefully chosen to create significant basin effects while maintaining computational efficiency. A larger radius would increase computational demands, while a smaller one might not produce noticeable basin effects. The z-coordinate of 70m places the basin’s top at the ground surface, which is realistic for many sedimentary basins formed by erosion and deposition processes.</p>
<p>Based on these parameters, the basin intersects with the top two soil layers (Layer 1 and Layer 2), as calculated in the code comments:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># according to the center of the semihemisphere and it raduis the bounds</span>
<span class="c1"># of the mesh is as follows:</span>
<span class="c1">#       xmin = center_x - radius = - 85.0</span>
<span class="c1">#       xmax = center_x + radius = 85.0</span>
<span class="c1">#       ymin = center_y - radius = - 85.0</span>
<span class="c1">#       ymax = center_y + radius = 85.0</span>
<span class="c1">#       zmin = center_z - radius = - 15.0</span>
<span class="c1">#       zmax = center_z + radius = 40.0</span>
<span class="c1"># so according to the below values only the layer 1 and layer 2 are intersecting with the semihemisphere</span>
</pre></div>
</div>
<p>This geometry calculation is crucial for understanding which layers need special treatment with external meshes. By determining that only Layers 1 and 2 intersect with the basin, we can optimize our approach by applying external mesh techniques only where needed, using simpler rectangular grid meshes for the deeper layers.</p>
</section>
<section id="interactive-mesh-visualization">
<h3>2. Interactive Mesh Visualization<a class="headerlink" href="#interactive-mesh-visualization" title="Link to this heading"></a></h3>
<p>Before diving into the implementation details, let’s visualize what we’re trying to build. The model uses PyVista to create interactive visualizations of the mesh components, providing intuitive insight into the complex 3D geometry:</p>
<p><strong>Basin Components Visualization</strong>:
The semi-hemispherical basin split into two parts (basin1 and basin2) corresponding to its intersection with Layer 1 and Layer 2:</p>
<div style="width: 100%; max-width: 800px; height: 500px; margin: 0 auto; border: 1px solid #ddd;">
    <iframe src="../images/DRM/Example3/basin.html" style="width: 100%; height: 100%; border: none;"></iframe>
</div><p>In this interactive visualization, we can see basin1 (intersecting with Layer 1) in red and basin2 (intersecting with Layer 2) in blue. The semi-hemispherical shape is clearly visible, showing how the basin structure is defined in the model. This division into two parts is not just for visualization purposes – it reflects how the basin is physically modeled in the simulation, with each part potentially assigned different material properties. The curved boundary of the semi-hemisphere is particularly important for capturing realistic wave propagation behaviors including focusing effects that would not be present with simpler geometries.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When examining the basin visualization closely, you’ll notice that the boundary between the basin and surrounding soil is not perfectly smooth but has a “stair-stepped” appearance. This occurs because we extract entire hexahedral elements based on their cell centers’ distances from the basin center. If a cell center falls within the radius, the entire element is included in the basin, creating a crenellated boundary with vertical and horizontal faces rather than a smooth curve. While this might introduce some additional wave reflections at the boundary, it can also be considered realistic in many geological settings where basin boundaries are often irregular and non-smooth due to natural depositional and erosional processes. This discretization effect is an inherent characteristic of structured element meshes when representing curved geometries, and becomes less pronounced with finer mesh resolution.</p>
</div>
<p><strong>Layer Structure Visualization</strong>:
The six soil layers each shown with a different color:</p>
<div style="width: 100%; max-width: 800px; height: 500px; margin: 0 auto; border: 1px solid #ddd;">
    <iframe src="../images/DRM/Example3/layers.html" style="width: 100%; height: 100%; border: none;"></iframe>
</div><p>This visualization shows the six soil layers of the model, each with a distinct color to illustrate the layered structure. You can rotate, zoom, and pan the model to examine the layer boundaries. Note how each layer has a uniform thickness and horizontal extent – this represents the idealized soil profile. In real geological settings, these layers would rarely be perfectly uniform, but this simplification allows us to isolate the basin effects from other potential variables.</p>
<p><strong>Complete Model Visualization</strong>:
The combined visualization showing the basin embedded within the layered soil:</p>
<div style="width: 100%; max-width: 800px; height: 500px; margin: 0 auto; border: 1px solid #ddd;">
    <iframe src="../images/DRM/Example3/layers_basin.html" style="width: 100%; height: 100%; border: none;"></iframe>
</div><p>This comprehensive visualization displays the complete model with regular soil layers (blue) and basin components (red). It illustrates how the semi-hemispherical basin is integrated into the soil profile, affecting only the top two layers. This visualization is particularly valuable for understanding the relationship between the basin geometry and the surrounding soil structure. Note that the mesh elements maintain their regular pattern outside the basin but conform to the curved basin boundary where they intersect – this is a key advantage of the external mesh approach used in this example.</p>
</section>
<section id="soft-material-definition-for-the-basin">
<h3>3. Soft Material Definition for the Basin<a class="headerlink" href="#soft-material-definition-for-the-basin" title="Link to this heading"></a></h3>
<p>Unlike Example 2 which used consistent material properties throughout each layer, Example 3 introduces a soft material for the basin. This is a key difference and is implemented as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Defining soft material for the basin</span>
<span class="n">BASIN</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">softMat_vs</span> <span class="o">=</span> <span class="mi">150</span>          <span class="c1"># Shear wave velocity (m/s)</span>
<span class="n">softMat_vp</span> <span class="o">=</span> <span class="mi">300</span>          <span class="c1"># P-wave velocity (m/s)</span>
<span class="n">softMat_xi_s</span> <span class="o">=</span> <span class="mf">0.03</span>       <span class="c1"># Damping ratio for shear waves</span>
<span class="n">softMat_xi_p</span> <span class="o">=</span> <span class="mf">0.01</span>       <span class="c1"># Damping ratio for pressure waves</span>
<span class="n">softMat_rho</span> <span class="o">=</span> <span class="mf">1.8</span>         <span class="c1"># Density (ton/m³)</span>

<span class="c1"># Calculate elastic parameters from wave velocities</span>
<span class="n">softMat_vs_vp_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">softMat_vp</span> <span class="o">/</span> <span class="n">softMat_vs</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">softMat_nu</span> <span class="o">=</span> <span class="p">(</span><span class="n">softMat_vs_vp_ratio</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">softMat_vs_vp_ratio</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">softMat_E</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">softMat_rho</span> <span class="o">*</span> <span class="p">(</span><span class="n">softMat_vs</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">softMat_nu</span><span class="p">)</span>

<span class="c1"># Create Femora material, element, damping, and region for soft material</span>
<span class="n">sofmat</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">create_material</span><span class="p">(</span><span class="s2">&quot;nDMaterial&quot;</span><span class="p">,</span> <span class="s2">&quot;ElasticIsotropic&quot;</span><span class="p">,</span>
                                <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;softMaterial&quot;</span><span class="p">,</span>
                                <span class="n">E</span><span class="o">=</span><span class="n">softMat_E</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="n">softMat_nu</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">softMat_rho</span><span class="p">)</span>

<span class="n">softele</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_type</span><span class="o">=</span><span class="s2">&quot;stdBrick&quot;</span><span class="p">,</span>
                                <span class="n">ndof</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                <span class="n">material</span><span class="o">=</span><span class="n">sofmat</span><span class="p">,</span>
                                <span class="n">b1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">b2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">b3</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">softMat_damp</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">damping</span><span class="o">.</span><span class="n">create_damping</span><span class="p">(</span><span class="s2">&quot;frequency rayleigh&quot;</span><span class="p">,</span> <span class="n">dampingFactor</span><span class="o">=</span><span class="n">softMat_xi_s</span><span class="p">,</span> <span class="n">f1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">softMat_reg</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s2">&quot;elementRegion&quot;</span><span class="p">,</span> <span class="n">damping</span><span class="o">=</span><span class="n">softMat_damp</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This example uses elastic isotropic material for the soft basin soil. In real seismic events, soft soils with such low shear wave velocities (Vs=150 m/s) would likely experience nonlinear behavior and enter the plastic region even at moderate shaking intensities. The elastic material assumption may exaggerate wave amplification effects since it doesn’t account for:</p>
<ol class="arabic simple">
<li><p><strong>Energy dissipation through hysteresis</strong> - In reality, soft soils dissipate energy through plastic deformation, which reduces amplification</p></li>
<li><p><strong>Strain-dependent stiffness reduction</strong> - Soft soils experience significant stiffness degradation at relatively low strain levels</p></li>
<li><p><strong>Permanent deformation</strong> - Plastic response can lead to permanent settlement and lateral spreading</p></li>
<li><p><strong>Damping increase with strain level</strong> - Material damping typically increases as the soil enters the nonlinear range</p></li>
</ol>
<p>In a subsequent example, we will implement more realistic elastoplastic constitutive models for the soft basin material to demonstrate how nonlinear behavior affects seismic wave amplification and basin response.</p>
</div>
<p>The soft material definition demonstrates several important geotechnical principles:</p>
<ol class="arabic">
<li><p><strong>Wave Velocity Relationship</strong>: The code maintains a specific relationship between P-wave (Vp) and S-wave (Vs) velocities, with Vp/Vs = 2.0. This ratio is typical for water-saturated sediments and corresponds to a Poisson’s ratio (ν) of approximately 0.33, which is calculated using the formula:</p>
<div class="math notranslate nohighlight">
\[\nu = \frac{(V_p/V_s)^2 - 2}{2[(V_p/V_s)^2 - 1]}\]</div>
</li>
<li><p><strong>Elastic Parameter Conversion</strong>: Rather than directly specifying Young’s modulus (E) and Poisson’s ratio (ν), the code derives these parameters from wave velocities using the relationship:</p>
<div class="math notranslate nohighlight">
\[E = 2\rho V_s^2 (1 + \nu)\]</div>
<p>This approach ensures consistency between the dynamic properties (wave velocities) and static elastic parameters.</p>
</li>
<li><p><strong>Damping Implementation</strong>: The model uses frequency-dependent Rayleigh damping with a higher damping ratio for soft materials (3% vs. typically 2-2.5% for stiffer soils). The damping is calibrated at two frequencies (f1=3Hz and f2=15Hz) that span the typical frequency range of engineering interest.</p></li>
<li><p><strong>Material Controls</strong>: The <cite>BASIN</cite> boolean flag functions as a master switch for the soft material implementation, allowing easy toggling between models with and without basin effects. This facilitates direct comparison of site response with and without the basin structure.</p></li>
</ol>
</section>
<section id="external-mesh-implementation-for-complex-geometry">
<h3>4. External Mesh Implementation for Complex Geometry<a class="headerlink" href="#external-mesh-implementation-for-complex-geometry" title="Link to this heading"></a></h3>
<p>For layers 1 and 2 that intersect with the basin, the implementation requires a special approach using external meshes. This is another key difference from Example 2:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Example for Layer 2 (Layer 1 follows the same pattern)</span>
<span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Get Layer 2 properties</span>
<span class="n">ele</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">helperfunction</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="n">zmax</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">zmin</span> <span class="o">+</span> <span class="n">thickness</span>
<span class="n">Nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thickness</span><span class="o">/</span><span class="n">dz</span><span class="p">)</span>

<span class="c1"># Create structured grid for the entire layer</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">Nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">Ny</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">Nz</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">StructuredGrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">cast_to_unstructured_grid</span><span class="p">()</span>

<span class="c1"># Identify cells inside and outside the basin based on distance from center</span>
<span class="n">cellcenters</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_centers</span><span class="p">()</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cellcenters</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">cellcenters</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">cellcenters</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">distances</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">)</span>

<span class="c1"># Extract separate mesh components</span>
<span class="n">semihemisphere</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">extract_cells</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>  <span class="c1"># Basin part</span>
<span class="n">boxwithhole</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">extract_cells</span><span class="p">(</span><span class="o">~</span><span class="n">mask</span><span class="p">)</span>    <span class="c1"># Regular soil part</span>

<span class="c1"># Add regular soil part to Femora</span>
<span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;General mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;External mesh&quot;</span><span class="p">,</span>
                        <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Layer</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                        <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                        <span class="n">mesh</span><span class="o">=</span><span class="n">boxwithhole</span><span class="p">)</span>

<span class="c1"># Add basin part with appropriate material</span>
<span class="k">if</span> <span class="n">BASIN</span><span class="p">:</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;General mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;External mesh&quot;</span><span class="p">,</span>
                                <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;basin</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">element</span><span class="o">=</span><span class="n">softele</span><span class="p">,</span>
                                <span class="n">region</span><span class="o">=</span><span class="n">softMat_reg</span><span class="p">,</span>
                                <span class="n">mesh</span><span class="o">=</span><span class="n">semihemisphere</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;General mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;External mesh&quot;</span><span class="p">,</span>
                                <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;basin</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                                <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                                <span class="n">mesh</span><span class="o">=</span><span class="n">semihemisphere</span><span class="p">)</span>
</pre></div>
</div>
<p>The external mesh implementation demonstrates several advanced computational techniques:</p>
<ol class="arabic">
<li><p><strong>Structured to Unstructured Grid Conversion</strong>:
The code first creates a structured grid (<cite>pv.StructuredGrid</cite>) with regular spacing but then converts it to an unstructured grid (<cite>cast_to_unstructured_grid()</cite>). This transformation is necessary because structured grids cannot represent complex geometries like the basin boundary, while unstructured grids can adapt to arbitrary shapes.</p></li>
<li><p><strong>Distance-Based Cell Selection</strong>:
The implementation uses a mathematical distance calculation to identify which cells lie within the basin boundary. This Euclidean distance formula:</p>
<div class="math notranslate nohighlight">
\[d = \sqrt{(x_{cell} - x_{center})^2 + (y_{cell} - y_{center})^2 + (z_{cell} - z_{center})^2}\]</div>
<p>creates a perfect spherical boundary, which when intersected with the layered domain creates the semi-hemispherical basin shape.</p>
</li>
<li><p><strong>Boolean Masking for Mesh Extraction</strong>:
The PyVista library’s <cite>extract_cells()</cite> method with a boolean mask provides an efficient way to separate the mesh into two complementary components without needing to recreate the geometry. This preserves the original cell quality and maintains exact matching at the basin-soil interface.</p></li>
<li><p><strong>Material Assignment Strategy</strong>:
The conditional structure using the <cite>BASIN</cite> flag demonstrates how to create parametric studies in Femora. This single variable controls whether the basin contains soft material (realistic scenario) or normal soil material (control scenario), enabling precise quantification of basin effects.</p></li>
</ol>
<p>For layers 3-6 which don’t intersect with the basin, the implementation remains the same as in Example 2, using regular uniform rectangular grids. This hybrid approach—using external meshes only where geometric complexity demands it—optimizes computational resources while maintaining model accuracy.</p>
</section>
<section id="assembly-with-separate-sections">
<h3>5. Assembly with Separate Sections<a class="headerlink" href="#assembly-with-separate-sections" title="Link to this heading"></a></h3>
<p>To optimize computational performance, the model creates separate assembly sections for regular soil layers and basin components:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regular soil layers</span>
<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Layer1&quot;</span><span class="p">,</span> <span class="s2">&quot;Layer2&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Layer3&quot;</span><span class="p">,</span> <span class="s2">&quot;Layer4&quot;</span><span class="p">,</span>
          <span class="s2">&quot;Layer5&quot;</span><span class="p">,</span> <span class="s2">&quot;Layer6&quot;</span><span class="p">]</span>
<span class="n">fm</span><span class="o">.</span><span class="n">assembler</span><span class="o">.</span><span class="n">create_section</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">num_partitions</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Basin components</span>
<span class="n">basins</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;basin1&quot;</span><span class="p">,</span> <span class="s2">&quot;basin2&quot;</span><span class="p">]</span>
<span class="n">fm</span><span class="o">.</span><span class="n">assembler</span><span class="o">.</span><span class="n">create_section</span><span class="p">(</span><span class="n">basins</span><span class="p">,</span> <span class="n">num_partitions</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fm</span><span class="o">.</span><span class="n">assembler</span><span class="o">.</span><span class="n">Assemble</span><span class="p">()</span>
</pre></div>
</div>
<p>This organization strategy demonstrates advanced parallel computing concepts:</p>
<ol class="arabic simple">
<li><p><strong>Domain Decomposition</strong>: By separating the model into distinct sections (regular layers and basin components), Femora can perform domain decomposition, a key technique in parallel computing where different parts of the model are assigned to different processors.</p></li>
<li><p><strong>Load Balancing</strong>: The different number of partitions for regular layers (8) versus basin components (2) reflects the relative computational demand and size of these regions. This balanced partitioning helps optimize computational resources.</p></li>
<li><p><strong>Interface Management</strong>: During assembly, Femora automatically handles the interfaces between different sections, ensuring proper connectivity between the basin and surrounding soil at their shared boundaries.</p></li>
<li><p><strong>Scalability</strong>: This partitioning approach improves the model’s scalability, allowing it to efficiently utilize available computational resources whether running on a laptop or high-performance computing cluster.</p></li>
</ol>
</section>
<section id="absorbing-boundary-and-simulation-setup">
<h3>6. Absorbing Boundary and Simulation Setup<a class="headerlink" href="#absorbing-boundary-and-simulation-setup" title="Link to this heading"></a></h3>
<p>The absorbing boundary implementation differs slightly from Example 2, using Rayleigh-type damping:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fm</span><span class="o">.</span><span class="n">drm</span><span class="o">.</span><span class="n">addAbsorbingLayer</span><span class="p">(</span><span class="n">numLayers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                       <span class="n">numPartitions</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                       <span class="n">partitionAlgo</span><span class="o">=</span><span class="s2">&quot;kd-tree&quot;</span><span class="p">,</span>
                       <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;Rectangular&quot;</span><span class="p">,</span>
                       <span class="n">rayleighDamping</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                       <span class="n">matchDamping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                       <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Rayleigh&quot;</span><span class="p">,</span>
                       <span class="p">)</span>
</pre></div>
</div>
<p>This absorbing boundary implementation showcases several advanced wave absorption concepts:</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt><strong>Rayleigh vs. PML</strong>: While Example 2 used Perfectly Matched Layer (PML) boundaries, Example 3 uses Rayleigh-type damping. This choice is deliberate for basin modeling, as Rayleigh damping offers:</dt><dd><ul class="simple">
<li><p>Better stability for models with large impedance contrasts (like soft basins)</p></li>
<li><p>More robust performance when evanescent waves are present</p></li>
</ul>
</dd>
</dl>
</li>
<li><p><strong>Layer Configuration</strong>: The 8-layer absorbing boundary represents a balance between computational efficiency and absorption quality. More layers would improve absorption but increase computational cost.</p></li>
<li><p><strong>High Damping Coefficient</strong>: The 0.95 Rayleigh damping coefficient is close to critical damping, providing strong energy absorption at the model boundaries to minimize artificial reflections.</p></li>
<li><p><strong>K-D Tree Partitioning</strong>: The “kd-tree” partitioning algorithm is particularly well-suited for the complex geometry in this model, as it efficiently subdivides space without requiring regular patterns, adapting to both the basin shape and rectangular boundaries.</p></li>
</ol>
</section>
<section id="dynamic-output-organization">
<h3>7. Dynamic Output Organization<a class="headerlink" href="#dynamic-output-organization" title="Link to this heading"></a></h3>
<p>Example 3 implements a dynamic approach to output organization based on the model configuration:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set result directory name based on whether basin is enabled and its Vs</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">BASIN</span><span class="p">:</span>
    <span class="n">resultdirectoryname</span> <span class="o">=</span> <span class="s2">&quot;Regular&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">resultdirectoryname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Vs</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">softMat_vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Create default process with result path based on configuration</span>
<span class="n">fm</span><span class="o">.</span><span class="n">drm</span><span class="o">.</span><span class="n">createDefaultProcess</span><span class="p">(</span><span class="n">finalTime</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">dT</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                          <span class="n">vtkhdfrecorder_file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resultdirectoryname</span><span class="si">}</span><span class="s2">/result&quot;</span><span class="p">,</span>
                          <span class="n">GravityElasticOptions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_steps&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
                          <span class="n">GravityPlasticOptions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_steps&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>

<span class="c1"># Create output directory</span>
<span class="n">fm</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">insert_step</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="n">fm</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">tcl</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file mkdir </span><span class="si">{</span><span class="n">resultdirectoryname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
                      <span class="n">description</span><span class="o">=</span><span class="s2">&quot;making result directory&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This dynamic output organization demonstrates several sophisticated workflow concepts:</p>
<ol class="arabic simple">
<li><p><strong>Parameterized Output Paths</strong>: By dynamically naming directories based on model parameters (Regular, Vs150, Vs200), the code establishes a direct link between simulation configuration and result storage. This systematic organization is essential for parameter studies where multiple model variations are being compared.</p></li>
<li><p><strong>Simulation Process Configuration</strong>: The <cite>createDefaultProcess</cite> method configures the complete simulation workflow, including:
- Simulation duration (finalTime=25s) - sufficient to capture basin resonance effects
- Time-step size (dT=0.01s) - appropriate for capturing frequencies up to 50 Hz
- Output file configuration (vtkhdfrecorder_file) with dynamic path assignment
- Multi-step gravity initialization (elastic followed by plastic steps) - crucial for establishing proper initial stress states</p></li>
<li><p><strong>TCL Command Integration</strong>: The use of <cite>fm.actions.tcl</cite> demonstrates Femora’s ability to interact directly with the underlying OpenSees TCL interpreter. This allows for direct filesystem operations (creating directories) that would otherwise be more complex to implement.</p></li>
<li><p><strong>Process Workflow Modification</strong>: The <cite>insert_step</cite> method shows how Femora’s process can be modified programmatically, inserting the directory creation step at the beginning (index=0) of the simulation process.</p></li>
</ol>
</section>
<section id="custom-drm-simulation-process">
<h3>8. Custom DRM Simulation Process<a class="headerlink" href="#custom-drm-simulation-process" title="Link to this heading"></a></h3>
<p>The example demonstrates how to customize the default DRM simulation process provided by Femora to suit specific modeling needs. The <cite>createDefaultProcess</cite> method in the DRM module offers extensive customization options:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Customizing the DRM simulation process</span>
<span class="n">fm</span><span class="o">.</span><span class="n">drm</span><span class="o">.</span><span class="n">createDefaultProcess</span><span class="p">(</span>
    <span class="n">finalTime</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>                                      <span class="c1"># Total simulation time</span>
    <span class="n">dT</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>                                           <span class="c1"># Time step for analysis</span>
    <span class="n">vtkhdfrecorder_file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resultdirectoryname</span><span class="si">}</span><span class="s2">/result&quot;</span><span class="p">,</span> <span class="c1"># Custom output directory</span>
    <span class="n">GravityElasticOptions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_steps&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>            <span class="c1"># Reduced elastic gravity steps</span>
    <span class="n">GravityPlasticOptions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_steps&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>              <span class="c1"># Minimal plastic steps (sufficient for elastic materials)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>This customization addresses several specific needs for the basin model:</p>
<ol class="arabic simple">
<li><p><strong>Custom Output Organization</strong>:
By specifying a dynamic directory name in <cite>vtkhdfrecorder_file</cite>, the results from different model configurations (Regular, Vs150, Vs200) are automatically stored in separate directories. This eliminates the need for manual file management between simulation runs.</p></li>
<li><p><strong>Optimized Gravity Analysis</strong>:
The gravity analysis phases are customized with:
- Reduced elastic gravity steps (10 instead of the default 20) - sufficient since our basin model has relatively simple material behavior
- Minimal plastic gravity steps (1 instead of default 50) - appropriate since our model uses elastic materials that don’t require extensive plastic initialization</p></li>
<li><p><strong>Efficient Computational Workflow</strong>:
These customizations make the simulation workflow more efficient by:
- Eliminating unnecessary computational steps (reduced gravity steps)
- Automating result organization for parametric studies
- Maintaining consistent analysis settings across different model variants</p></li>
</ol>
<p>The DRM module also supports more extensive customization options including:</p>
<ul class="simple">
<li><p>Custom constraint handlers, numberers, and system solvers</p></li>
<li><p>Alternative solution algorithms and convergence tests</p></li>
<li><p>Different time integrators and their parameters</p></li>
<li><p>Selective recorder configuration for specific response types</p></li>
<li><p>Custom damping models and analysis parameters</p></li>
</ul>
<p>This flexibility enables adapting the simulation process to various model complexities, from simple elastic analyses to complex nonlinear problems with advanced damping and boundary conditions.</p>
</section>
<section id="tcl-actions-and-process-flow-management">
<h3>9. TCL Actions and Process Flow Management<a class="headerlink" href="#tcl-actions-and-process-flow-management" title="Link to this heading"></a></h3>
<p>A critical aspect of this example is the use of TCL actions to ensure proper execution flow. The default DRM simulation process clears all existing steps before adding new ones, which creates a challenge when we need to prepare the environment before analysis:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create output directory using TCL action</span>
<span class="n">fm</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">insert_step</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="n">fm</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">tcl</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file mkdir </span><span class="si">{</span><span class="n">resultdirectoryname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span>
                      <span class="n">description</span><span class="o">=</span><span class="s2">&quot;making result directory&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This code demonstrates several important concepts:</p>
<ol class="arabic simple">
<li><p><strong>Direct TCL Command Execution</strong>:
The <cite>fm.actions.tcl()</cite> function allows direct execution of TCL commands, providing access to the full power of the underlying OpenSees TCL interpreter. In this case, we use it to create a directory - a filesystem operation not directly available through Femora’s Python API.</p></li>
<li><p><strong>Process Step Insertion</strong>:
The <cite>insert_step</cite> method is used to place the directory creation step at the beginning (index=0) of the process flow. This ensures the directory exists before any recorders attempt to write to it.</p></li>
<li><p><strong>Execution Order Management</strong>:
The sequence is critical because:
- The directory must exist before the VTK HDF recorder initializes
- The <cite>createDefaultProcess</cite> method adds the recorder later in the sequence
- If the directory doesn’t exist when the recorder initializes, the simulation would fail</p></li>
<li><p><strong>Adaptive Workflow Creation</strong>:
By programmatically constructing the workflow, we can adapt to different simulation configurations (Regular, Vs150, Vs200) without manual intervention.</p></li>
</ol>
<p>This approach demonstrates how Femora allows for flexible process flow management, combining the power of Python for logic and decision-making with direct TCL access for operations not yet exposed through the Python API.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This pattern of inserting preparation steps before calling <cite>createDefaultProcess</cite> is particularly important in parametric studies where the same model is run with different configurations. It ensures that the output organization is properly established before simulation begins.</p>
</div>
</section>
</section>
<section id="results-and-analysis">
<h2>Results and Analysis<a class="headerlink" href="#results-and-analysis" title="Link to this heading"></a></h2>
<p>The basin model demonstrates several important seismic wave phenomena that are visualized in the acceleration comparison plots:</p>
<ol class="arabic simple">
<li><p><strong>Amplification Effects</strong>: Soft basin materials typically amplify seismic waves, leading to higher accelerations at the surface compared to regular soil profiles.</p></li>
<li><p><strong>Wave Trapping</strong>: Basins can trap seismic energy, leading to longer duration of shaking and resonance effects.</p></li>
<li><p><strong>Lateral Variations</strong>: The curved geometry of the basin creates complex wave patterns including focusing and defocusing effects.</p></li>
<li><p><strong>Frequency-Dependent Response</strong>: Softer basins (Vs=150 m/s) respond differently to different frequency components of seismic waves than stiffer basins (Vs=200 m/s).</p></li>
</ol>
<p>Comparisons between the regular soil profile and basin models with different shear wave velocities illustrate these phenomena:</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/acceleration_comparison_Regular_Vs150.png"><img alt="Acceleration comparison between regular soil and basin model with Vs=150m/s" src="../../_images/acceleration_comparison_Regular_Vs150.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Comparison of surface acceleration between regular soil profile and a model with a Vs=150m/s basin</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/acceleration_comparison_Regular_Vs200.png"><img alt="Acceleration comparison between regular soil and basin model with Vs=200m/s" src="../../_images/acceleration_comparison_Regular_Vs200.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-text">Comparison of surface acceleration between regular soil profile and a model with a Vs=200m/s basin</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The plots clearly show:</p>
<ul class="simple">
<li><p><strong>Enhanced amplification in the softest basin model</strong>: The Vs=150 m/s model shows significantly greater amplification compared to both the regular soil profile and the Vs=200 m/s model. This demonstrates the inverse relationship between shear wave velocity and amplification - as shear wave velocity decreases, amplification increases. This relationship is governed by the impedance contrast between the basin and surrounding material.</p></li>
<li><p><strong>Velocity-dependent resonance periods</strong>: The Vs=150 m/s basin exhibits longer predominant periods of oscillation compared to the Vs=200 m/s basin, consistent with the relationship between material stiffness and natural period (T ∝ 1/√G, where G is shear modulus).</p></li>
<li><p><strong>Longer duration of significant shaking</strong>: Both basin models show extended duration of strong motion compared to the regular soil profile, with the Vs=150 m/s model showing the longest duration due to greater energy trapping.</p></li>
<li><p><strong>Phase shifts in wave arrivals</strong>: The basin models show delayed arrivals of peak acceleration compared to the regular soil model, with the Vs=150 m/s model showing more significant delay due to the slower wave propagation speeds.</p></li>
</ul>
<p>These results demonstrate that basins with very soft materials (Vs=150 m/s) can significantly amplify ground motion, sometimes by factors of 2-3 compared to surrounding areas, highlighting the importance of site-specific analysis in regions with basin structures and soft soil deposits.</p>
</section>
<section id="data-visualization-and-post-processing">
<h2>Data Visualization and Post-Processing<a class="headerlink" href="#data-visualization-and-post-processing" title="Link to this heading"></a></h2>
<p>The response data from the Femora simulations is stored in VTKHDF format, which requires post-processing for visualization and analysis. Example3 includes a Python script (plot.py) that processes these files and creates the comparison plots shown above.</p>
<div class="literal-block-wrapper docutils container" id="example3-plot">
<div class="code-block-caption"><span class="caption-text">Python script for post-processing and visualization of simulation results</span><a class="headerlink" href="#example3-plot" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">h5py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">AutoMinorLocator</span>

<span class="c1"># Set up matplotlib for publication quality</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
    <span class="s1">&#39;font.family&#39;</span><span class="p">:</span> <span class="s1">&#39;serif&#39;</span><span class="p">,</span>
    <span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="s1">&#39;axes.titlesize&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
    <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
    <span class="s1">&#39;figure.figsize&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;figure.dpi&#39;</span><span class="p">:</span> <span class="mi">300</span>
<span class="p">})</span>

<span class="c1"># ============= USER CONFIGURATION =============</span>
<span class="c1"># Specify the folders to compare (you can modify this list)</span>
<span class="n">folders_to_compare</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Regular&quot;</span><span class="p">,</span> <span class="s2">&quot;Vs200&quot;</span><span class="p">]</span>  <span class="c1"># Change to [&quot;Regular&quot;, &quot;Vs150&quot;] or any other folders as needed</span>

<span class="c1"># Colors and styles for each folder</span>
<span class="n">folder_styles</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Regular&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
    <span class="s2">&quot;Vs200&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
    <span class="s2">&quot;Vs150&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
    <span class="c1"># Add more folders with their styles as needed</span>
<span class="p">}</span>

<span class="c1"># User-defined y-axis ranges for each component (min, max)</span>
<span class="n">y_ranges</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">),</span>  <span class="c1"># y-range for a_x</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">),</span>  <span class="c1"># y-range for a_y</span>
    <span class="p">(</span><span class="o">-</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">)</span>   <span class="c1"># y-range for a_z</span>
<span class="p">]</span>

<span class="c1"># Output filename (without extension)</span>
<span class="n">output_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;acceleration_comparison_</span><span class="si">{</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folders_to_compare</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="c1"># Maximum time to plot (seconds)</span>
<span class="n">max_time</span> <span class="o">=</span> <span class="mf">25.0</span>
<span class="c1"># ============================================</span>

<span class="c1"># Change to the script&#39;s directory</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">process_vtk_data</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process VTK HDF files in the specified folder.&quot;&quot;&quot;</span>
    <span class="n">basename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">/result&quot;</span>
    <span class="n">files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">basename</span><span class="si">}</span><span class="s2">*.vtkhdf&quot;</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;VTKHDF&quot;</span><span class="p">][</span><span class="s2">&quot;Points&quot;</span><span class="p">][()]</span>
                <span class="c1"># Skip if no points exist</span>
                <span class="k">if</span> <span class="n">points</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="c1"># Find the closest point to (0, 0, 0)</span>
                <span class="n">desired_point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
                <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">points</span> <span class="o">-</span> <span class="n">desired_point</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">closest_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span>
                <span class="n">closest_point</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="n">closest_index</span><span class="p">]</span>
                
                <span class="c1"># Skip if distance is too large</span>
                <span class="k">if</span> <span class="n">distances</span><span class="p">[</span><span class="n">closest_index</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1e-3</span><span class="p">:</span>
                    <span class="k">continue</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Closest point to (0, 0, 0): </span><span class="si">{</span><span class="n">closest_point</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Index: </span><span class="si">{</span><span class="n">closest_index</span><span class="si">}</span><span class="s2">, Distance: </span><span class="si">{</span><span class="n">distances</span><span class="p">[</span><span class="n">closest_index</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Filename: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># Extract acceleration data</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;VTKHDF&quot;</span><span class="p">][</span><span class="s2">&quot;PointData&quot;</span><span class="p">][</span><span class="s2">&quot;acceleration&quot;</span><span class="p">][()]</span>
                <span class="n">accoffset</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;VTKHDF&quot;</span><span class="p">][</span><span class="s2">&quot;Steps&quot;</span><span class="p">][</span><span class="s2">&quot;PointDataOffsets&quot;</span><span class="p">][</span><span class="s2">&quot;acceleration&quot;</span><span class="p">][()]</span>
                <span class="n">accoffset</span> <span class="o">+=</span> <span class="n">closest_index</span>
                <span class="n">acc</span> <span class="o">=</span> <span class="n">acc</span><span class="p">[</span><span class="n">accoffset</span><span class="p">]</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Acceleration shape: </span><span class="si">{</span><span class="n">acc</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                
                <span class="c1"># Get time values</span>
                <span class="n">time</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;VTKHDF&quot;</span><span class="p">][</span><span class="s2">&quot;Steps&quot;</span><span class="p">][</span><span class="s2">&quot;Values&quot;</span><span class="p">][()]</span>
                
                <span class="c1"># Filter to time &lt; max_time</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time</span> <span class="o">&lt;</span> <span class="n">max_time</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">time_filtered</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                <span class="n">acc_filtered</span> <span class="o">=</span> <span class="n">acc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                
                <span class="k">return</span> <span class="n">time_filtered</span><span class="p">,</span> <span class="n">acc_filtered</span>
                
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

<span class="c1"># Create figure with three subplots</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Component labels for plots</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$a_x$&#39;</span><span class="p">,</span> <span class="s1">&#39;$a_y$&#39;</span><span class="p">,</span> <span class="s1">&#39;$a_z$&#39;</span><span class="p">]</span>

<span class="c1"># Process data from each folder and plot</span>
<span class="n">folder_data</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders_to_compare</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2"> subfolder...&quot;</span><span class="p">)</span>
    <span class="n">time_data</span><span class="p">,</span> <span class="n">acc_data</span> <span class="o">=</span> <span class="n">process_vtk_data</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="n">folder_data</span><span class="p">[</span><span class="n">folder</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">time_data</span><span class="p">,</span> <span class="n">acc_data</span><span class="p">)</span>
    
    <span class="c1"># Skip if no data was found</span>
    <span class="k">if</span> <span class="n">time_data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">acc_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No valid data found in folder: </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">continue</span>
    
    <span class="c1"># Get style for this folder</span>
    <span class="n">style</span> <span class="o">=</span> <span class="n">folder_styles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
    
    <span class="c1"># Plot each component</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_data</span><span class="p">,</span> <span class="n">acc_data</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mf">9.81</span><span class="p">,</span> 
                    <span class="n">color</span><span class="o">=</span><span class="n">style</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">],</span> 
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">style</span><span class="p">[</span><span class="s2">&quot;linestyle&quot;</span><span class="p">],</span> 
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">style</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">],</span>
                    <span class="n">label</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>

<span class="c1"># Format plots</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="c1"># Formatting for publication quality</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> (g)&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">AutoMinorLocator</span><span class="p">())</span>
    
    <span class="c1"># Set user-defined y-axis range</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_ranges</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="c1"># Add legend</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>

<span class="c1"># Set common x-axis label</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">)</span>

<span class="c1"># Save the figure in multiple formats</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="c1"># plt.savefig(f&quot;{output_filename}.pdf&quot;, bbox_inches=&#39;tight&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="code-access">
<h2>Code Access<a class="headerlink" href="#code-access" title="Link to this heading"></a></h2>
<p>The full source code for this example is available in the Femora repository:</p>
<ul class="simple">
<li><p>Example directory: <code class="docutils literal notranslate"><span class="pre">examples/DRM/Example3/</span></code></p></li>
<li><p>Python script: <code class="docutils literal notranslate"><span class="pre">examples/DRM/Example3/femoramodel.py</span></code></p></li>
<li><p>Data file: <code class="docutils literal notranslate"><span class="pre">drmload.h5drm</span></code> (required for running the example)</p></li>
</ul>
<p>Below is the complete code for Example3’s femoramodel.py:</p>
<div class="literal-block-wrapper docutils container" id="example3-code">
<div class="code-block-caption"><span class="caption-text">Example3 - Seismic Wave Basin Effects Model with External Mesh</span><a class="headerlink" href="#example3-code" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">femora</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">fm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="c1"># change the direcotto the current file</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)))</span>


<span class="c1"># this example is the extension of the example2 which we have semihemispherical basin at the center in this model we are going to use External mesh as a part of the model</span>
<span class="c1"># Parameters for the semihemispherical hole</span>
<span class="n">center_x</span><span class="p">,</span> <span class="n">center_y</span><span class="p">,</span> <span class="n">center_z</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">70</span>  <span class="c1"># Center at the top surface</span>
<span class="n">radius</span> <span class="o">=</span> <span class="mf">85.0</span>  <span class="c1"># Radius of the semihemisphere</span>

<span class="c1"># according to the center of the semihemisphere and it raduis the bounds</span>
<span class="c1"># of the mesh is as follows:</span>
<span class="c1">#       xmin = center_x - radius = - 85.0</span>
<span class="c1">#       xmax = center_x + radius = 85.0</span>
<span class="c1">#       ymin = center_y - radius = - 85.0</span>
<span class="c1">#       ymax = center_y + radius = 85.0</span>
<span class="c1">#       zmin = center_z - radius = - 15.0</span>
<span class="c1">#       zmax = center_z + radius = 40.0</span>
<span class="c1"># so according to the below values only the layer 1 and layer 2 are intersecting with the semihemisphere</span>



<span class="c1"># =========================================================</span>
<span class="c1"># Layering and initial information</span>
<span class="c1"># =========================================================</span>

<span class="c1"># layers [ layer, rho(m/ton), vp(m/s), vs(m/s), xi_s, xi_p, thickness(m) ]</span>
<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">2.1420500</span><span class="p">,</span> <span class="mf">669.0500</span><span class="p">,</span> <span class="mf">353.1000</span><span class="p">,</span> <span class="mf">0.0296</span><span class="p">,</span> <span class="mf">0.0148</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mf">2.1462000</span><span class="p">,</span> <span class="mf">785.2500</span><span class="p">,</span> <span class="mf">414.4000</span><span class="p">,</span> <span class="mf">0.0269</span><span class="p">,</span> <span class="mf">0.0134</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mf">2.1503500</span><span class="p">,</span> <span class="mf">886.0500</span><span class="p">,</span> <span class="mf">467.6000</span><span class="p">,</span> <span class="mf">0.0249</span><span class="p">,</span> <span class="mf">0.0125</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mf">2.1544500</span><span class="p">,</span> <span class="mf">976.4000</span><span class="p">,</span> <span class="mf">515.3000</span><span class="p">,</span> <span class="mf">0.0234</span><span class="p">,</span> <span class="mf">0.0117</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mf">2.1586000</span><span class="p">,</span> <span class="mf">1059.0500</span><span class="p">,</span> <span class="mf">558.9500</span><span class="p">,</span> <span class="mf">0.0221</span><span class="p">,</span> <span class="mf">0.0111</span><span class="p">,</span> <span class="mi">8</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mf">2.1627500</span><span class="p">,</span> <span class="mf">1135.6500</span><span class="p">,</span> <span class="mf">599.4000</span><span class="p">,</span> <span class="mf">0.0211</span><span class="p">,</span> <span class="mf">0.0105</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">pi</span> <span class="o">=</span> <span class="mf">3.1415926</span>
<span class="n">f1</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span> <span class="c1"># Hz</span>
<span class="n">f2</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1"># Hz</span>
<span class="n">w1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">f1</span>
<span class="n">w2</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">f2</span>

<span class="c1"># mesh parameters</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">64</span>
<span class="n">xmax</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">64</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">48</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">zmin</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">dy</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">dz</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">Nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">)</span>
<span class="n">Ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="p">)</span>



<span class="c1"># =========================================================</span>
<span class="c1"># Defining soft material for the basin</span>
<span class="c1"># =========================================================</span>
<span class="c1"># using Soft material in the basin</span>
<span class="c1"># keeping the ratio of vp/vs = 2.0</span>
<span class="n">BASIN</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">softMat_vs</span> <span class="o">=</span> <span class="mi">150</span>
<span class="n">softMat_vp</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">softMat_xi_s</span> <span class="o">=</span> <span class="mf">0.03</span>
<span class="n">softMat_xi_p</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">softMat_rho</span>  <span class="o">=</span> <span class="mf">1.8</span>
<span class="n">softMat_vs_vp_ratio</span>   <span class="o">=</span> <span class="p">(</span><span class="n">softMat_vp</span> <span class="o">/</span> <span class="n">softMat_vs</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">softMat_nu</span>            <span class="o">=</span> <span class="p">(</span><span class="n">softMat_vs_vp_ratio</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">softMat_vs_vp_ratio</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">softMat_E</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">softMat_rho</span> <span class="o">*</span> <span class="p">(</span><span class="n">softMat_vs</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">softMat_nu</span><span class="p">)</span>
<span class="c1"># softMat_E = softMat_E / 1000.</span>
<span class="c1"># softMat_rho = softMat_rho / 1000.</span>
<span class="n">sofmat</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">create_material</span><span class="p">(</span><span class="s2">&quot;nDMaterial&quot;</span><span class="p">,</span> <span class="s2">&quot;ElasticIsotropic&quot;</span><span class="p">,</span>
                                <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;softMaterial&quot;</span><span class="p">,</span>
                                <span class="n">E</span><span class="o">=</span><span class="n">softMat_E</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="n">softMat_nu</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">softMat_rho</span><span class="p">)</span>

<span class="n">softele</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_type</span><span class="o">=</span><span class="s2">&quot;stdBrick&quot;</span><span class="p">,</span>
                                <span class="n">ndof</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                <span class="n">material</span><span class="o">=</span><span class="n">sofmat</span><span class="p">,</span>
                                <span class="n">b1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">b2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                <span class="n">b3</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">softMat_damp</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">damping</span><span class="o">.</span><span class="n">create_damping</span><span class="p">(</span><span class="s2">&quot;frequency rayleigh&quot;</span><span class="p">,</span> <span class="n">dampingFactor</span><span class="o">=</span><span class="n">softMat_xi_s</span><span class="p">,</span> <span class="n">f1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">softMat_reg</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s2">&quot;elementRegion&quot;</span><span class="p">,</span> <span class="n">damping</span><span class="o">=</span><span class="n">softMat_damp</span><span class="p">)</span>


<span class="c1"># =========================================================</span>
<span class="c1"># Defining a helpher function</span>
<span class="c1"># =========================================================</span>
<span class="k">def</span><span class="w"> </span><span class="nf">helperfunction</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span><span class="p">):</span>
    <span class="n">vp_vs_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">vp</span> <span class="o">/</span> <span class="n">vs</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="p">(</span><span class="n">vp_vs_ratio</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">vp_vs_ratio</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">E</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">(</span><span class="n">vs</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span>
    <span class="c1"># E = E / 1000.</span>
    <span class="c1"># rho = rho / 1000.</span>
    <span class="n">mat</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">create_material</span><span class="p">(</span><span class="s2">&quot;nDMaterial&quot;</span><span class="p">,</span> <span class="s2">&quot;ElasticIsotropic&quot;</span><span class="p">,</span>
                                <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Layer</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="n">E</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="n">nu</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="n">rho</span><span class="p">)</span>
    <span class="n">ele</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">element</span><span class="o">.</span><span class="n">create_element</span><span class="p">(</span><span class="n">element_type</span><span class="o">=</span><span class="s2">&quot;stdBrick&quot;</span><span class="p">,</span>
                                    <span class="n">ndof</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                                    <span class="n">material</span><span class="o">=</span><span class="n">mat</span><span class="p">,</span>
                                    <span class="n">b1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">b2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                    <span class="n">b3</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">damp</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">damping</span><span class="o">.</span><span class="n">create_damping</span><span class="p">(</span><span class="s2">&quot;frequency rayleigh&quot;</span><span class="p">,</span> <span class="n">dampingFactor</span><span class="o">=</span><span class="n">xi_s</span><span class="p">,</span> <span class="n">f1</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">f2</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">reg</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">create_region</span><span class="p">(</span><span class="s2">&quot;elementRegion&quot;</span><span class="p">,</span> <span class="n">damping</span><span class="o">=</span><span class="n">damp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ele</span><span class="p">,</span> <span class="n">reg</span>


<span class="c1"># =========================================================</span>
<span class="c1"># layer 6 (bottom layer)</span>
<span class="c1"># =========================================================</span>
<span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
<span class="n">ele</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">helperfunction</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">zmin</span> <span class="o">+</span> <span class="n">thickness</span>
<span class="n">Nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thickness</span><span class="o">/</span><span class="n">dz</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;Volume mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;Uniform Rectangular Grid&quot;</span><span class="p">,</span>
                        <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Layer</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                        <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;X Min&#39;</span><span class="p">:</span> <span class="n">xmin</span><span class="p">,</span> <span class="s1">&#39;X Max&#39;</span><span class="p">:</span> <span class="n">xmax</span><span class="p">,</span>
                            <span class="s1">&#39;Y Min&#39;</span><span class="p">:</span> <span class="n">ymin</span><span class="p">,</span> <span class="s1">&#39;Y Max&#39;</span><span class="p">:</span> <span class="n">ymax</span><span class="p">,</span>
                            <span class="s1">&#39;Z Min&#39;</span><span class="p">:</span> <span class="n">zmin</span><span class="p">,</span> <span class="s1">&#39;Z Max&#39;</span><span class="p">:</span> <span class="n">zmax</span><span class="p">,</span>
                            <span class="s1">&#39;Nx Cells&#39;</span><span class="p">:</span> <span class="n">Nx</span><span class="p">,</span> <span class="s1">&#39;Ny Cells&#39;</span><span class="p">:</span> <span class="n">Ny</span><span class="p">,</span> <span class="s1">&#39;Nz Cells&#39;</span><span class="p">:</span> <span class="n">Nz</span><span class="p">})</span>

<span class="c1"># =========================================================</span>
<span class="c1"># layer 5</span>
<span class="c1"># =========================================================</span>
<span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
<span class="n">ele</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">helperfunction</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="n">zmax</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">zmin</span> <span class="o">+</span> <span class="n">thickness</span>
<span class="n">Nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thickness</span><span class="o">/</span><span class="n">dz</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;Volume mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;Uniform Rectangular Grid&quot;</span><span class="p">,</span>
                        <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Layer</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                        <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;X Min&#39;</span><span class="p">:</span> <span class="n">xmin</span><span class="p">,</span> <span class="s1">&#39;X Max&#39;</span><span class="p">:</span> <span class="n">xmax</span><span class="p">,</span>
                            <span class="s1">&#39;Y Min&#39;</span><span class="p">:</span> <span class="n">ymin</span><span class="p">,</span> <span class="s1">&#39;Y Max&#39;</span><span class="p">:</span> <span class="n">ymax</span><span class="p">,</span>
                            <span class="s1">&#39;Z Min&#39;</span><span class="p">:</span> <span class="n">zmin</span><span class="p">,</span> <span class="s1">&#39;Z Max&#39;</span><span class="p">:</span> <span class="n">zmax</span><span class="p">,</span>
                            <span class="s1">&#39;Nx Cells&#39;</span><span class="p">:</span> <span class="n">Nx</span><span class="p">,</span> <span class="s1">&#39;Ny Cells&#39;</span><span class="p">:</span> <span class="n">Ny</span><span class="p">,</span> <span class="s1">&#39;Nz Cells&#39;</span><span class="p">:</span> <span class="n">Nz</span><span class="p">})</span>

<span class="c1"># =========================================================</span>
<span class="c1"># layer 4</span>
<span class="c1"># =========================================================</span>
<span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">ele</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">helperfunction</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="n">zmax</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">zmin</span> <span class="o">+</span> <span class="n">thickness</span>
<span class="n">Nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thickness</span><span class="o">/</span><span class="n">dz</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;Volume mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;Uniform Rectangular Grid&quot;</span><span class="p">,</span>
                        <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Layer</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                        <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;X Min&#39;</span><span class="p">:</span> <span class="n">xmin</span><span class="p">,</span> <span class="s1">&#39;X Max&#39;</span><span class="p">:</span> <span class="n">xmax</span><span class="p">,</span>
                            <span class="s1">&#39;Y Min&#39;</span><span class="p">:</span> <span class="n">ymin</span><span class="p">,</span> <span class="s1">&#39;Y Max&#39;</span><span class="p">:</span> <span class="n">ymax</span><span class="p">,</span>
                            <span class="s1">&#39;Z Min&#39;</span><span class="p">:</span> <span class="n">zmin</span><span class="p">,</span> <span class="s1">&#39;Z Max&#39;</span><span class="p">:</span> <span class="n">zmax</span><span class="p">,</span>
                            <span class="s1">&#39;Nx Cells&#39;</span><span class="p">:</span> <span class="n">Nx</span><span class="p">,</span> <span class="s1">&#39;Ny Cells&#39;</span><span class="p">:</span> <span class="n">Ny</span><span class="p">,</span> <span class="s1">&#39;Nz Cells&#39;</span><span class="p">:</span> <span class="n">Nz</span><span class="p">})</span>

<span class="c1"># =========================================================</span>
<span class="c1"># layer 3</span>
<span class="c1"># =========================================================</span>
<span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">ele</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">helperfunction</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="n">zmax</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">zmin</span> <span class="o">+</span> <span class="n">thickness</span>
<span class="n">Nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thickness</span><span class="o">/</span><span class="n">dz</span><span class="p">)</span>
<span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;Volume mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;Uniform Rectangular Grid&quot;</span><span class="p">,</span>
                        <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Layer</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                        <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                        <span class="o">**</span><span class="p">{</span><span class="s1">&#39;X Min&#39;</span><span class="p">:</span> <span class="n">xmin</span><span class="p">,</span> <span class="s1">&#39;X Max&#39;</span><span class="p">:</span> <span class="n">xmax</span><span class="p">,</span>
                            <span class="s1">&#39;Y Min&#39;</span><span class="p">:</span> <span class="n">ymin</span><span class="p">,</span> <span class="s1">&#39;Y Max&#39;</span><span class="p">:</span> <span class="n">ymax</span><span class="p">,</span>
                            <span class="s1">&#39;Z Min&#39;</span><span class="p">:</span> <span class="n">zmin</span><span class="p">,</span> <span class="s1">&#39;Z Max&#39;</span><span class="p">:</span> <span class="n">zmax</span><span class="p">,</span>
                            <span class="s1">&#39;Nx Cells&#39;</span><span class="p">:</span> <span class="n">Nx</span><span class="p">,</span> <span class="s1">&#39;Ny Cells&#39;</span><span class="p">:</span> <span class="n">Ny</span><span class="p">,</span> <span class="s1">&#39;Nz Cells&#39;</span><span class="p">:</span> <span class="n">Nz</span><span class="p">})</span>

<span class="c1"># =========================================================</span>
<span class="c1"># layer 2</span>
<span class="c1"># =========================================================</span>
<span class="c1"># Cause layer 2 is intersecting with the semihemisphere we need to define it by hand</span>
<span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">ele</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">helperfunction</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="n">zmax</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">zmin</span> <span class="o">+</span> <span class="n">thickness</span>
<span class="n">Nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thickness</span><span class="o">/</span><span class="n">dz</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">Nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">Ny</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">Nz</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">StructuredGrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">cast_to_unstructured_grid</span><span class="p">()</span>

<span class="n">cellcenters</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_centers</span><span class="p">()</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cellcenters</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">cellcenters</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">cellcenters</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">distances</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">)</span> 

<span class="n">semihemisphere</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">extract_cells</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">boxwithhole</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">extract_cells</span><span class="p">(</span><span class="o">~</span><span class="n">mask</span><span class="p">)</span>

<span class="c1"># now adding the semihemisphere part and the box part to the femora as </span>
<span class="c1"># external mesh part</span>
<span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;General mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;External mesh&quot;</span><span class="p">,</span>
                        <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Layer</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                        <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                        <span class="n">mesh</span><span class="o">=</span><span class="n">boxwithhole</span><span class="p">)</span>

<span class="k">if</span> <span class="n">BASIN</span><span class="p">:</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;General mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;External mesh&quot;</span><span class="p">,</span>
                                        <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;basin</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                        <span class="n">element</span><span class="o">=</span><span class="n">softele</span><span class="p">,</span>
                                        <span class="n">region</span><span class="o">=</span><span class="n">softMat_reg</span><span class="p">,</span>
                                        <span class="n">mesh</span><span class="o">=</span><span class="n">semihemisphere</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;General mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;External mesh&quot;</span><span class="p">,</span>
                                        <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;basin</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                        <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                                        <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                                        <span class="n">mesh</span><span class="o">=</span><span class="n">semihemisphere</span><span class="p">)</span>
<span class="c1"># =========================================================</span>
<span class="c1"># layer 1</span>
<span class="c1"># =========================================================</span>
<span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span> <span class="o">=</span> <span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ele</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">helperfunction</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">vp</span><span class="p">,</span> <span class="n">vs</span><span class="p">,</span> <span class="n">xi_s</span><span class="p">,</span> <span class="n">xi_p</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>
<span class="n">zmin</span> <span class="o">=</span> <span class="n">zmax</span>
<span class="n">zmax</span> <span class="o">=</span> <span class="n">zmin</span> <span class="o">+</span> <span class="n">thickness</span>
<span class="n">Nz</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">thickness</span><span class="o">/</span><span class="n">dz</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">Nx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">Ny</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span><span class="p">,</span> <span class="n">Nz</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">StructuredGrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">cast_to_unstructured_grid</span><span class="p">()</span>

<span class="n">cellcenters</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_centers</span><span class="p">()</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">cellcenters</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">cellcenters</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                    <span class="p">(</span><span class="n">cellcenters</span><span class="o">.</span><span class="n">points</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">distances</span> <span class="o">&lt;=</span> <span class="n">radius</span><span class="p">)</span> 

<span class="n">semihemisphere</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">extract_cells</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">boxwithhole</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">extract_cells</span><span class="p">(</span><span class="o">~</span><span class="n">mask</span><span class="p">)</span>

<span class="c1"># now adding the semihemisphere part and the box part to the femora as </span>
<span class="c1"># external mesh part</span>
<span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;General mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;External mesh&quot;</span><span class="p">,</span>
                        <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Layer</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                        <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                        <span class="n">mesh</span><span class="o">=</span><span class="n">boxwithhole</span><span class="p">)</span>


<span class="k">if</span> <span class="n">BASIN</span><span class="p">:</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;General mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;External mesh&quot;</span><span class="p">,</span>
                                            <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;basin</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                            <span class="n">element</span><span class="o">=</span><span class="n">softele</span><span class="p">,</span>
                                            <span class="n">region</span><span class="o">=</span><span class="n">softMat_reg</span><span class="p">,</span>
                                            <span class="n">mesh</span><span class="o">=</span><span class="n">semihemisphere</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">create_mesh_part</span><span class="p">(</span><span class="s2">&quot;General mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;External mesh&quot;</span><span class="p">,</span>
                                            <span class="n">user_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;basin</span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                                            <span class="n">element</span><span class="o">=</span><span class="n">ele</span><span class="p">,</span>
                                            <span class="n">region</span><span class="o">=</span><span class="n">reg</span><span class="p">,</span>
                                            <span class="n">mesh</span><span class="o">=</span><span class="n">semihemisphere</span><span class="p">)</span>
<span class="c1"># =========================================================</span>
<span class="c1"># plotting if you want to see the mesh</span>
<span class="c1"># =========================================================</span>
<span class="n">PLOTTING</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="n">PLOTTING</span><span class="p">:</span>
    <span class="n">pl</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;basin1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;basin2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">show_axes_all</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">show_grid</span><span class="p">()</span>
    <span class="c1"># pl.export_html(&quot;basin.html&quot;)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">pl</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer5&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer6&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;purple&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">show_axes_all</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">show_grid</span><span class="p">()</span>
    <span class="c1"># pl.export_html(&quot;layers.html&quot;)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">pl</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer4&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer5&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>      
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;Layer6&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;royalblue&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;basin1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">fm</span><span class="o">.</span><span class="n">meshPart</span><span class="o">.</span><span class="n">get_mesh_part</span><span class="p">(</span><span class="s2">&quot;basin2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mesh</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">show_axes_all</span><span class="p">()</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">show_grid</span><span class="p">()</span>
    <span class="c1"># pl.export_html(&quot;layers_basin.html&quot;)</span>
    <span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>



<span class="c1"># create a list of mesh parts</span>
<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Layer1&quot;</span><span class="p">,</span> <span class="s2">&quot;Layer2&quot;</span><span class="p">,</span> 
              <span class="s2">&quot;Layer3&quot;</span><span class="p">,</span> <span class="s2">&quot;Layer4&quot;</span><span class="p">,</span> 
              <span class="s2">&quot;Layer5&quot;</span><span class="p">,</span> <span class="s2">&quot;Layer6&quot;</span><span class="p">]</span>

<span class="n">fm</span><span class="o">.</span><span class="n">assembler</span><span class="o">.</span><span class="n">create_section</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="n">num_partitions</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">basins</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;basin1&quot;</span><span class="p">,</span> <span class="s2">&quot;basin2&quot;</span><span class="p">]</span>
<span class="n">fm</span><span class="o">.</span><span class="n">assembler</span><span class="o">.</span><span class="n">create_section</span><span class="p">(</span><span class="n">basins</span><span class="p">,</span> <span class="n">num_partitions</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fm</span><span class="o">.</span><span class="n">assembler</span><span class="o">.</span><span class="n">Assemble</span><span class="p">()</span>
<span class="n">fm</span><span class="o">.</span><span class="n">drm</span><span class="o">.</span><span class="n">addAbsorbingLayer</span><span class="p">(</span><span class="n">numLayers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                        <span class="n">numPartitions</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                        <span class="n">partitionAlgo</span><span class="o">=</span><span class="s2">&quot;kd-tree&quot;</span><span class="p">,</span>
                        <span class="n">geometry</span><span class="o">=</span><span class="s2">&quot;Rectangular&quot;</span><span class="p">,</span>
                        <span class="n">rayleighDamping</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                        <span class="n">matchDamping</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;Rayleigh&quot;</span><span class="p">,</span>
                        <span class="p">)</span>

<span class="n">h5pattern</span> <span class="o">=</span> <span class="n">fm</span><span class="o">.</span><span class="n">pattern</span><span class="o">.</span><span class="n">create_pattern</span><span class="p">(</span> <span class="s1">&#39;h5drm&#39;</span><span class="p">,</span>
                                        <span class="n">filepath</span><span class="o">=</span><span class="s1">&#39;drmload.h5drm&#39;</span><span class="p">,</span>
                                        <span class="n">factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                        <span class="n">crd_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                        <span class="n">distance_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                                        <span class="n">do_coordinate_transformation</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">transform_matrix</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                                        <span class="n">origin</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>
<span class="n">fm</span><span class="o">.</span><span class="n">drm</span><span class="o">.</span><span class="n">set_pattern</span><span class="p">(</span><span class="n">h5pattern</span><span class="p">)</span>




<span class="c1"># =========================================================</span>
<span class="c1"># Defining default process</span>
<span class="c1"># =========================================================</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">BASIN</span><span class="p">:</span>
    <span class="n">resultdirectoryname</span> <span class="o">=</span> <span class="s2">&quot;Regular&quot;</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">resultdirectoryname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Vs</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">softMat_vs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>


<span class="n">fm</span><span class="o">.</span><span class="n">drm</span><span class="o">.</span><span class="n">createDefaultProcess</span><span class="p">(</span><span class="n">finalTime</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">dT</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                            <span class="n">vtkhdfrecorder_file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">resultdirectoryname</span><span class="si">}</span><span class="s2">/result&quot;</span><span class="p">,</span>
                            <span class="n">GravityElasticOptions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_steps&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
                            <span class="n">GravityPlasticOptions</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;num_steps&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">})</span>


<span class="c1"># =========================================================</span>
<span class="c1"># add a explicit tcl command to make the result directory</span>
<span class="c1"># =========================================================</span>

<span class="n">fm</span><span class="o">.</span><span class="n">process</span><span class="o">.</span><span class="n">insert_step</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="n">fm</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">tcl</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;file mkdir </span><span class="si">{</span><span class="n">resultdirectoryname</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;making result directory&quot;</span><span class="p">)</span>


<span class="n">fm</span><span class="o">.</span><span class="n">export_to_tcl</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s2">&quot;model.tcl&quot;</span><span class="p">)</span>
<span class="c1"># fm.gui()</span>
</pre></div>
</div>
</div>
<p>To run this example, ensure that:</p>
<ol class="arabic simple">
<li><p>You have a working installation of Femora</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">drmload.h5drm</span></code> file is in the example directory</p></li>
<li><p>You execute the script from the Example3 directory to maintain correct paths</p></li>
</ol>
<p>This will generate the model and create output files in the appropriate directory (Vs150 for the basin model or Regular for the control model) for post-processing and visualization.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example2.html" class="btn btn-neutral float-left" title="Example 2: Multi-layer Soil Model with Absorbing Boundaries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../technical/index.html" class="btn btn-neutral float-right" title="Technical Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Amin Pakzad.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>